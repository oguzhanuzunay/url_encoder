<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />
    <style>
      #holder {
        border: 10px dashed #ccc;
        width: 300px;
        height: 300px;
        margin: 20px auto;
      }
      #holder.hover {
        border: 10px dashed #333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row" id="url_encoder">
        <div class="row">
          <div class="col-sm">
            <div class="mb-3">
              <label for="exampleFormControlTextarea1" class="form-label"
                >URL</label
              >
              <textarea class="form-control" id="url" rows="3"></textarea>
            </div>
          </div>
        </div>
        <div class="row align-content-center justify-content-center">
          <div class="col-sm">
            <div class="row justify-content-center">
              <div class="btn-group" role="group">
                <button
                  name="URL Encode"
                  id="convert"
                  type="submit"
                  class="btn btn-outline-primary"
                >
                  URL Encode
                </button>

                <button
                  class="btn btn-outline-primary"
                  name="Sort"
                  id="sort"
                  type="submit"
                >
                  SKU ; SKU
                </button>

                <button
                  class="btn btn-outline-primary"
                  name="SortComma"
                  id="SortComma"
                  type="submit"
                >
                  SKU , SKU
                </button>

                <button
                  class="btn btn-outline-primary"
                  id="deleteDublicate"
                  name="Delete SKU Dublicates"
                  for="btncheck3"
                >
                  Delete SKU Dublicates
                </button>
              </div>
              <div class="btn-group m-2" role="group">
                <button
                  name='; EN ; " RU " ;'
                  id="impex1"
                  type="submit"
                  class="btn btn-outline-dark"
                >
                  ; EN ; " RU " ;
                </button>

                <button
                  class="btn btn-outline-dark"
                  name='; EN ; " x1 x2 " ;'
                  id="impex2"
                  type="submit"
                >
                  ; EN ; " x1 x2 " ;
                </button>

                <button
                  class="btn btn-outline-dark"
                  name='; EN ; " x1 x2 " ;'
                  id="impex3"
                  type="submit"
                >
                  ; EN ; " x1 " ; " x2 ";
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm">
            <div class="mb-3">
              <label for="exampleFormControlTextarea1" class="form-label"
                >Encoded URLs</label
              >
              <textarea
                class="form-control"
                id="encodedUrl"
                rows="3"
                readonly
              ></textarea>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm">
            <button
              name="Copy All"
              id="copy"
              type="submit"
              class="btn btn-lg btn-danger mb-3"
            >
              Copy All
            </button>
          </div>
        </div>
        <div class="row">
          <div class="col-sm">
            <div id="holder"></div>
            <p id="status">Drag and Drop</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const convert = document.getElementById('convert');
      const copy = document.getElementById('copy');
      const textNode = document.getElementById('encodedUrl');
      const textArea = document.getElementById('url');
      const showEncoder = document.getElementById('url_encoder_button');
      const SortButton = document.getElementById('sort');
      const deleteDublicates = document.getElementById('deleteDublicate');
      const sortbyCommaButton = document.getElementById('SortComma');
      const impex1 = document.getElementById('impex1');
      const impex2 = document.getElementById('impex2');
      const impex3 = document.getElementById('impex3');

      let arrayOfLines = [];
      let newArray = [];
      var holder = document.getElementById('holder'),
        state = document.getElementById('status');

      const splitLine = () => {
        arrayOfLines = [];
        arrayOfLines = textArea.value.split('\n');
        return arrayOfLines;
      };

      const encodetoArray = (arr) => {
        let newArr = [];
        arr.forEach((element) => {
          newArr.push(encodeURI(element));
        });
        return newArr;
      };

      const sortSKU = (a) => {
        let arr = splitLine();
        let sku = '';
        arr.map((value) => {
          sku = sku + value + a;
        });

        return sku;
      };

      const delDuplicates = (array) =>
        array.filter((item, index) => array.indexOf(item) === index);

      const versusSKu = () => {
        let arr = splitLine();
      };
      //----------------------------------- SKU ; SKU
      const showSKU = () => {
        let sku = sortSKU(';');
        write(sku, textNode);
      };
      //------------------------------------ SKU , SKU
      const showSKUComma = () => {
        let sku = sortSKU(',');
        write(sku, textNode);
      };
      //------------------------------------ dublicate delete
      const noDublicate = () => {
        let arr = splitLine();
        arr = delDuplicates(arr);
        write(arr, textNode);
        copyOnchange();
      };
      //------------------------------------ Impex-1
      const makeImpex1 = () => {
        let arr = splitLine();
        let impex = impexMaker(arr, 1);
        console.log(impex);
        write(impex, textNode);
        copyOnchange();
      };
      //------------------------------------ Impex-2
      const makeImpex2 = () => {
        let arr = splitLine();
        let impex = impexMaker(arr, 1);
        console.log(impex);
        write(impex, textNode);
        copyOnchange();
      };
      //------------------------------------ Impex-3
      const makeImpex3 = () => {
        let arr = splitLine();
        let impex = impexMaker(arr, 3);
        console.log(impex);
        write(impex, textNode);
        copyOnchange();
      };
      //---------------------------------------

      const impexMaker = (arr, impexType) => {
        let impex = arr.map((str) => {
          str = str.split(/\t/);

          if (impexType === 1) {
            return (str = `;${str[0]};"${str[1]}${
              str[2] ? ' ' + str[2] : ''
            }";`);
          } else {
            str = `;${str[0]};"${str[1]}";"${str[1]}";`;
          }
        });
        return impex;
      };

      //---------------------------------------------------------------

      const showUrl = () => {
        let arr = splitLine();
        let encodedarr = encodetoArray(arr);
        write(encodedarr, textNode);
      };
      const write = (Arr, txtArea) => {
        let text = '';
        console.log(Arr);
        typeof Arr !== 'string'
          ? Arr.forEach((element) => {
              element === ''
                ? element
                : text === ''
                ? (text = `${element}`)
                : (text = `${text}\n${element}`);
            })
          : (text = Arr);
        txtArea.value = text;
      };

      const calculate = (area) => {
        result = area.value.split('\n');
        result = result.filter((item) => item !== '');
        return result.length;
      };

      const count = (txtArea, btn) => {
        let number = calculate(txtArea);
        console.log(number);
        btn.textContent = `${btn.name} (${number})`;
      };

      const copyClipboard = () => {
        textNode.select();
        textNode.setSelectionRange(0, 99999); /* For mobile devices */
        document.execCommand('copy');
      };
      const convertOnchange = () => {
        count(textArea, convert);
        count(textArea, deleteDublicates);
      };
      const copyOnchange = () => {
        count(textNode, copy);
      };

      convert.addEventListener('click', showUrl);
      copy.addEventListener('click', copyClipboard);
      textArea.addEventListener('keyup', convertOnchange);
      convert.addEventListener('click', copyOnchange);
      SortButton.addEventListener('click', showSKU);
      deleteDublicates.addEventListener('click', noDublicate);
      impex1.addEventListener('click', makeImpex1);
      impex2.addEventListener('click', makeImpex2);
      impex3.addEventListener('click', makeImpex3);

      //-------------------------------DEV-------------------------------------------------

      if (typeof window.FileReader === 'undefined') {
        state.className = 'fail';
      } else {
        state.className = 'success';
        state.innerHTML = 'Drop to .txt File';
      }

      holder.ondragover = function () {
        this.className = 'hover';
        return false;
      };
      holder.ondragend = function () {
        this.className = '';
        return false;
      };
      holder.ondrop = function (e) {
        this.className = '';
        e.preventDefault();

        var file = e.dataTransfer.files[0],
          reader = new FileReader();
        reader.onload = function (event) {
          console.log(event.target);
          textArea.value = event.target.result;
          setTimeout(convertOnchange, 50);
        };
        reader.readAsText(file);
        //setTimeout(splitLine, 100);
        //setTimeout(copyOnchange, 101);
        return false;
      };
      //--------------------------------------------------------------------------
    </script>
  </body>
</html>
